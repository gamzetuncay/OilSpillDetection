/**** Start of imports. If edited, may not auto-convert in the playground. ****/
var geometry = /* color: #d63000 */ee.Geometry.MultiPolygon(
        [[[[41.15471380200828, 41.92708760982102],
           [41.14647405591453, 41.94139012338012],
           [41.12999456372703, 41.96385902157404]]],
         [[[41.13205450025047, 41.95058290270711],
           [41.14647405591453, 41.909204957774676],
           [41.15677373853172, 41.895406345258664],
           [41.16020696607078, 41.864732086382816],
           [41.16501348462547, 41.836089494260484],
           [41.16844671216453, 41.80641043291527],
           [41.17325323071922, 41.77620555072613],
           [41.17668645825828, 41.770572557915386],
           [41.185612849859844, 41.770572557915386],
           [41.17874639478172, 41.777741735636056],
           [41.17393987622703, 41.80436309405432],
           [41.16844671216453, 41.82943848694588],
           [41.16570013013328, 41.85859546774088],
           [41.163640193609844, 41.87035680277332],
           [41.16226690259422, 41.89336185276378],
           [41.16501348462547, 41.90664988413534],
           [41.15952032056297, 41.92095697934846],
           [41.149907283453594, 41.936282451007],
           [41.13823430982078, 41.957221307852976],
           [41.133427791266094, 41.9618167217653],
           [41.15128057446922, 41.92708760982102],
           [41.158147029547344, 41.902561553607086],
           [41.14853399243797, 41.91840237612868],
           [41.14372747388328, 41.93270683693378]]],
         [[[41.169133357672344, 41.88416083056723],
           [41.17050664868797, 41.89233958587426],
           [41.17943304028953, 41.89796187274435],
           [41.180119685797344, 41.904605755493854],
           [41.169133357672344, 41.924022372116205],
           [41.160893611578594, 41.94496525452198],
           [41.15677373853172, 41.96181672566074],
           [41.15128057446922, 41.97304856450935],
           [41.14098089185203, 41.98427842306652],
           [41.13480108228172, 41.98938224956483],
           [41.13480108228172, 41.977642836913525],
           [41.14372747388328, 41.971517066727124],
           [41.14922063794578, 41.96079555120837],
           [41.15746038403953, 41.946497390546675],
           [41.160893611578594, 41.932706840831],
           [41.163640193609844, 41.92453325594356],
           [41.16776006665672, 41.91482576371116],
           [41.17393987622703, 41.904605755493854]]]]),
    geometry2 = /* color: #98ff00 */ee.Geometry.LineString(
        [[41.134756696683404, 41.99039652085209],
         [41.179128131368024, 41.77094149952408]]),
    geometry3 = /* color: #0b4a8b */ee.Geometry.LineString(
        [[41.163635076606944, 41.902169853375],
         [41.15179044159718, 41.9015310241632]]),
    geometry4 = /* color: #ffc82d */ee.Geometry.LineString(
        [[41.16071683319874, 41.94591443989378],
         [41.15745526703663, 41.945850601044135]]),
    geometry5 = /* color: #00ffff */ee.Geometry.Polygon(
        [[[29.549001851007603, 43.27200749269861],
          [29.53732887737479, 43.27050761850059],
          [29.54007545940604, 43.25450666051308],
          [29.53732887737479, 43.24800507007707],
          [29.535268940851353, 43.226494864911736],
          [29.53458229534354, 43.21248413772999],
          [29.536642231866978, 43.20097291767894],
          [29.544881977960728, 43.19997183936285],
          [29.542135395929478, 43.21498628942188],
          [29.543508686945103, 43.228496134547754],
          [29.546255268976353, 43.24500410194349],
          [29.547628559991978, 43.26100755689613]]]),
    geometry6 = /* color: #bf04c2 */ee.Geometry.LineString(
        [[29.544195332452915, 43.271007580673555],
         [29.544195332452915, 43.200222110481754]]),
    geometry7 = /* color: #ff0000 */ee.Geometry.LineString(
        [[29.54007545940604, 43.2560069289734],
         [29.54728523723807, 43.25625697012331]]),
    geometry8 = /* color: #00ff00 */ee.Geometry.LineString(
        [[29.537672200128696, 43.2680077460313],
         [29.54934517376151, 43.2680077460313]]),
    geometry9 = /* color: #0000ff */ee.Geometry.Polygon(
        [[[29.836362996027134, 43.30886777640029],
          [29.833616413995884, 43.28837871508701],
          [29.828809895441196, 43.27288240224455],
          [29.82674995891776, 43.26038250086519],
          [29.82949654094901, 43.255381821606775],
          [29.831556477472446, 43.230372265157555],
          [29.828123249933384, 43.22036556792015],
          [29.825376667902134, 43.2013483178128],
          [29.826063313409946, 43.18082305562811],
          [29.823316731378696, 43.1723105567068],
          [29.82400337688651, 43.15678470964375],
          [29.82125679485526, 43.14426099107106],
          [29.822630085870884, 43.127224615681044],
          [29.817823567316196, 43.115196081378976],
          [29.81851021282401, 43.10366651695266],
          [29.809583821222446, 43.079096289936516],
          [29.80477730266776, 43.061038413572795],
          [29.80477730266776, 43.04548431250405],
          [29.795850911066196, 43.02390273824555],
          [29.784864582941196, 43.00733498746495],
          [29.773878254816196, 42.99176727111728],
          [29.75877205364432, 42.975693233186455],
          [29.75877205364432, 42.967152191130204],
          [29.765638508722446, 42.96514236180255],
          [29.76426521770682, 42.97519085178111],
          [29.77181831829276, 42.98473539666109],
          [29.78005806438651, 42.99126502104854],
          [29.78623787395682, 42.99729175098519],
          [29.79104439251151, 43.00934343774582],
          [29.79997078411307, 43.01938470405705],
          [29.80546394817557, 43.031432056383586],
          [29.80821053020682, 43.041971550178765],
          [29.81027046673026, 43.05551966796588],
          [29.81301704876151, 43.06906479322048],
          [29.81645027630057, 43.08160390754133],
          [29.82194344036307, 43.09815160972242],
          [29.82469002239432, 43.115196081378976],
          [29.826063313409946, 43.13273690356556],
          [29.828809895441196, 43.14726691756341],
          [29.83018318645682, 43.1652993724557],
          [29.83018318645682, 43.18432785732625],
          [29.83224312298026, 43.21486118427551],
          [29.836362996027134, 43.25738214259234],
          [29.833616413995884, 43.27038262731563],
          [29.839109578058384, 43.28088099204147],
          [29.839109578058384, 43.295375756185365],
          [29.842542805597446, 43.312365218802974],
          [29.841856160089634, 43.3263529758124],
          [29.834303059503696, 43.32735197809105]]]),
    geometry10 = /* color: #999900 */ee.Geometry.LineString(
        [[29.76151863567557, 42.966147284674555],
         [29.83842293255057, 43.32585346851193]]),
    geometry11 = /* color: #009999 */ee.Geometry.LineString(
        [[29.82674995891776, 43.26075753525379],
         [29.83567635051932, 43.26125757751175]]),
    geometry12 = /* color: #ff00ff */ee.Geometry.LineString(
        [[29.833788075372837, 43.230747484349635],
         [29.831041493341587, 43.230997629194356]]),
    geometry13 = 
    /* color: #ff9999 */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[29.464886783270234, 42.52877657435517],
          [29.46351349225461, 42.500433300331984],
          [29.451153873113984, 42.45688110259336],
          [29.442914127020234, 42.42343676586925],
          [29.440167544988984, 42.41076379512424],
          [29.442914127020234, 42.39504575464004],
          [29.437420962957734, 42.37577310745935],
          [29.436734317449922, 42.35649454391227],
          [29.44154083600461, 42.358016750866064],
          [29.44978058209836, 42.42292989621269],
          [29.451153873113984, 42.436613938583136],
          [29.455960391668672, 42.461946869048084],
          [29.455960391668672, 42.474103036412465],
          [29.46351349225461, 42.489294925843275],
          [29.469693301824922, 42.53231857976622],
          [29.480679629949922, 42.556095414104476],
          [29.499905704168672, 42.61726644647024],
          [29.494412540106172, 42.618782321037216]]]),
    geometry14 = 
    /* color: #99ff99 */
    /* shown: false */
    ee.Geometry.LineString(
        [[29.495099185613984, 42.61726644647024],
         [29.436734317449922, 42.35649454391227]]),
    geometry15 = 
    /* color: #9999ff */
    /* shown: false */
    ee.Geometry.LineString(
        [[29.44008439692339, 42.411083130497666],
         [29.44832414301714, 42.41095638850206]]),
    geometry16 = 
    /* color: #ffff99 */
    /* shown: false */
    ee.Geometry.LineString(
        [[29.463555736744436, 42.489306838804254],
         [29.46042291661504, 42.48949671404317]]),
    geometry17 = /* color: #99ffff */ee.Geometry.MultiPolygon(
        [[[[30.060661892114364, 43.20637244088029],
           [30.112846950708114, 43.20437044502019],
           [30.121086696801864, 43.20286890500816],
           [30.140312771020614, 43.20336942245188],
           [30.181511501489364, 43.202368383458065],
           [30.219963649926864, 43.19736294210822],
           [30.222710231958114, 43.20136732803885],
           [30.176704982934677, 43.20487095014479],
           [30.151985744653427, 43.20336942245188],
           [30.134819606958114, 43.206872929579326],
           [30.08744106691905, 43.20737341417196],
           [30.05997524660655, 43.21037623549317]]],
         [[[30.3373800317628, 43.188852749416746],
           [30.404671291528427, 43.182344154288195],
           [30.406731228051864, 43.18735082751874],
           [30.27970180910655, 43.19736294210822],
           [30.242622951684677, 43.19686237538842]]],
         [[[30.01956188667912, 43.21214169140547],
           [29.974243283163496, 43.207137051938666],
           [29.97561657417912, 43.19912877466203],
           [30.05252087105412, 43.2001298668106]]]]),
    geometry18 = /* color: #ff99ff */ee.Geometry.MultiLineString(
        [[[30.05997524660655, 43.206872929579326],
          [30.2220235864503, 43.20086679416967]],
         [[30.242622951684677, 43.19636180456232],
          [30.40604458254405, 43.18484754223098]],
         [[29.974243283163496, 43.203133044704074],
          [30.045654415975996, 43.20413407115102]]]),
    geometry19 = /* color: #d63000 */ee.Geometry.LineString(
        [[30.121013760458418, 43.2028827874352],
         [30.12118542183537, 43.20713705384787]]),
    geometry20 = /* color: #98ff00 */ee.Geometry.LineString(
        [[30.14521801460881, 43.20438432710554],
         [30.14521801460881, 43.2028827874352]]),
    geometry21 = 
    /* color: #0b4a8b */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[35.6605127692095, 43.5430264875001],
          [35.67561897038137, 43.529835465475145],
          [35.6934717535845, 43.523114401413466],
          [35.703771436201684, 43.523114401413466],
          [35.76076301335012, 43.50120351331264],
          [35.788915479170434, 43.49647170921513],
          [35.80745490788137, 43.49398113706199],
          [35.824621045576684, 43.48899968459824],
          [35.8472803473345, 43.48302139928897],
          [35.863073194014184, 43.47953379296361],
          [35.88641914127981, 43.477291654014124],
          [35.88985236881887, 43.47853729703547],
          [35.87920936344778, 43.48102850604084],
          [35.8692530035845, 43.481526735515885],
          [35.8586099982134, 43.48351961232931],
          [35.843847119795434, 43.48601061590044],
          [35.83389075993215, 43.48924876697971],
          [35.82324775456106, 43.49149046218953],
          [35.81603797672903, 43.49597360300208],
          [35.80676826237356, 43.49696981131939],
          [35.797841870772, 43.49696981131939],
          [35.7871988654009, 43.49896217864846],
          [35.77312263249075, 43.502199635344915],
          [35.75732978581106, 43.50593494658848],
          [35.744970166670434, 43.5094210285577],
          [35.73501380680715, 43.51489875058601],
          [35.7267740607134, 43.517388459878354],
          [35.71304115055715, 43.52236757029142],
          [35.68145545719778, 43.53431575880982],
          [35.66875251530325, 43.542031039341055]]]),
    geometry22 = 
    /* color: #ffc82d */
    /* shown: false */
    ee.Geometry.LineString(
        [[35.66119941471731, 43.54277762700127],
         [35.89019569157278, 43.478288170485534]]),
    geometry23 = 
    /* color: #00ffff */
    /* shown: false */
    ee.Geometry.LineString(
        [[35.67493232487356, 43.53020883596541],
         [35.68094047306692, 43.53456465423605]]),
    geometry24 = 
    /* color: #bf04c2 */
    /* shown: false */
    ee.Geometry.LineString(
        [[35.7448779293885, 43.50941879796369],
         [35.74389087647102, 43.507644656340496]]);
/***** End of imports. If edited, may not auto-convert in the playground. *****/
////    3  Frost
function Frost(img, kernelSize, bandName,  dampingFactor){
    /*
    Input : img = ee.Image type, the image which is processed
          : kernelSize = integer, Square kernel should be odd (typically 3, 5 or 7)
          : band name = string,
          : damping factor = integer, it is an exponential damping is the key factor 
                                      in controlling the smoothness of the filter. 
                                      When damping factor is small, the image tends to be smooth. 
    
    the fuction reduces the noise on the band with the help of Frost Filter function.
    the frost filter works on preserving the edges while suppressing the noise. 
    the function saves the original bands and adds the new low noise band
    
    Output: image with new filtered band 
    
    source: https://groups.google.com/forum/#!msg/google-earth-engine-developers/a9W0Nlrhoq0/Hyu96dv1AgAJ
    */
    
    var band = img.select(bandName);
    
    // ~~(kernelSize/2) does integer division in JavaScript
    var distance_kernel = ee.Kernel.euclidean(~~(kernelSize/2));
  
    var weights = ee.List.repeat(ee.List.repeat(1,kernelSize),kernelSize);
    
    var kernel = ee.Kernel.fixed(kernelSize, kernelSize, weights, ~~(kernelSize/2), ~~(kernelSize/2), false);
    
    // Get mean and variance
    var mean = band.reduceNeighborhood(ee.Reducer.mean(), kernel);
    
    var variance = band.reduceNeighborhood(ee.Reducer.variance(), kernel);
    
    var B = variance.multiply(dampingFactor).divide(mean.multiply(mean));
    
    var W = B.exp().reduceNeighborhood(ee.Reducer.mean(), distance_kernel);
    
    var frost = band.multiply(W).reduceNeighborhood(ee.Reducer.sum(), kernel).divide(W.reduceNeighborhood(ee.Reducer.sum(), kernel));
    
    var newBandName = bandName.concat('_Frost'); 
    
    frost = frost.rename(newBandName);
    
   return img.addBands(frost); // Add filtered band to original image
}

// 1 Study Area
var region010316 = ee.Geometry.Rectangle(
                [41.68959635214067, 41.76163098915713,
                40.995101907596016, 42.27757741759697], null, true);    
    // Dataset
    var sar1 = ee.ImageCollection('COPERNICUS/S1_GRD')
        .filter(ee.Filter.listContains('transmitterReceiverPolarisation','VV'))
        .filter(ee.Filter.listContains('transmitterReceiverPolarisation','VH'))
        .filter(ee.Filter.eq('instrumentMode','IW'))
        .filter(ee.Filter.eq('orbitProperties_pass','DESCENDING'))
        .filterDate('2016-03-08','2016-03-10')
        .filterBounds(region010316);
    print(sar1);
    

// 2 Study Area
var region080819 = ee.Geometry.Rectangle(
                [29.35239035861587,43.39975485811164,
                 30.05949869815924,42.88380842002836], null, true);

    // Dataset
    var sar2 = ee.ImageCollection('COPERNICUS/S1_GRD')
        .filter(ee.Filter.listContains('transmitterReceiverPolarisation','VV'))
        .filter(ee.Filter.listContains('transmitterReceiverPolarisation','VH'))
        .filter(ee.Filter.eq('instrumentMode','IW'))
        .filter(ee.Filter.eq('orbitProperties_pass','DESCENDING'))
        .filterDate('2019-08-08','2019-08-09')
        .filterBounds(region080819);
    print(sar2);
    

// 3 Study Area
var region210719 = ee.Geometry.Rectangle(
                [29.180880485613216, 42.809049704488125,
                29.881258903581966, 42.29310326379858], null, true);

    // Dataset
    var sar3 = ee.ImageCollection('COPERNICUS/S1_GRD')
        .filter(ee.Filter.listContains('transmitterReceiverPolarisation','VV'))
        .filter(ee.Filter.listContains('transmitterReceiverPolarisation','VH'))
        .filter(ee.Filter.eq('instrumentMode','IW'))
        .filter(ee.Filter.eq('orbitProperties_pass','DESCENDING'))
        .filterDate('2019-07-21', '2019-07-26')
        .filterBounds(region210719);
    print(sar3);
    
    
// 4 Study Area
var region220519 = ee.Geometry.Rectangle(
                [30.5878268333208, 42.96969847052448,
                 29.87972286728966, 43.48564490868279], null, true);

    // Dataset
    var sar4 = ee.ImageCollection('COPERNICUS/S1_GRD')
        .filter(ee.Filter.listContains('transmitterReceiverPolarisation','VV'))
        .filter(ee.Filter.listContains('transmitterReceiverPolarisation','VH'))
        .filter(ee.Filter.eq('instrumentMode','IW'))
        .filter(ee.Filter.eq('orbitProperties_pass','DESCENDING'))
        .filterDate('2019-05-22', '2019-05-23')
        .filterBounds(region220519);
    print(sar4);
    
    
// 5 Study Area
var region250915 = ee.Geometry.Rectangle(
                [36.215817911076336, 43.323600262718614,
                 35.503564816425694, 43.83954667563497], null, true);

    // Dataset
    var sar5 = ee.ImageCollection('COPERNICUS/S1_GRD')
        .filter(ee.Filter.listContains('transmitterReceiverPolarisation','VV'))
        .filter(ee.Filter.listContains('transmitterReceiverPolarisation','VH'))
        .filter(ee.Filter.eq('instrumentMode','IW'))
        .filter(ee.Filter.eq('orbitProperties_pass','DESCENDING'))
        .filterDate('2015-09-25', '2015-09-26')
        .filterBounds(region250915);
    print(sar5);
    
    


sar1 = Frost(sar1.mosaic(), 7, 'VV',-1).select('VV_Frost')
sar2 = Frost(sar2.mosaic(), 7, 'VV',-1).select('VV_Frost')
sar3 = Frost(sar3.mosaic(), 7, 'VV',-1).select('VV_Frost')
sar4 = Frost(sar4.mosaic(), 7, 'VV',-1).select('VV_Frost')
sar5 = Frost(sar5.mosaic(), 7, 'VV',-1).select('VV_Frost')


sar1 = sar1.clip(region010316);
sar2 = sar2.clip(region080819);
sar3 = sar3.clip(region210719);
sar4 = sar4.clip(region220519);
sar5 = sar5.clip(region250915);

var canny1 = ee.Algorithms.CannyEdgeDetector({image: sar1, threshold: 2, sigma: 0});
var hough1 = ee.Algorithms.HoughTransform(canny1,256,1);

var canny2 = ee.Algorithms.CannyEdgeDetector({image: sar2, threshold: 2, sigma: 0});
var hough2 = ee.Algorithms.HoughTransform(canny2,256,1);
var canny3 = ee.Algorithms.CannyEdgeDetector({image: sar3, threshold: 2, sigma: 0});
var hough3 = ee.Algorithms.HoughTransform(canny3,256,1);
var canny4 = ee.Algorithms.CannyEdgeDetector({image: sar4, threshold: 2, sigma: 0});
var hough4 = ee.Algorithms.HoughTransform(canny4,256,1);
var canny5 = ee.Algorithms.CannyEdgeDetector({image: sar5, threshold: 2, sigma: 0});
var hough5 = ee.Algorithms.HoughTransform(canny5,256,1);


////     MAP LAYERS
var imageVisParam = {"opacity":1,"bands":["VV_Frost"],"min":-40,"gamma":1}
Map.addLayer(sar1, imageVisParam, 'sar1')
Map.addLayer(sar2, imageVisParam, 'sar2')
Map.addLayer(sar3, imageVisParam, 'sar3')
Map.addLayer(sar4, imageVisParam, 'sar4')
Map.addLayer(sar5, imageVisParam, 'sar5')

Map.addLayer(canny1, {}, 'canny1');
Map.addLayer(hough1, {}, 'hough1');
Map.addLayer(canny2, {}, 'canny2');
Map.addLayer(hough2, {}, 'hough2');
Map.addLayer(canny3, {}, 'canny3');
Map.addLayer(hough3, {}, 'hough3');
Map.addLayer(canny4, {}, 'canny4');
Map.addLayer(hough4, {}, 'hough4');
Map.addLayer(canny5, {}, 'canny5');
Map.addLayer(hough5, {}, 'hough5');



print('sar1')
print(geometry.area().divide(1000000))
print(geometry2.length());
print(geometry3.length());
print(geometry4.length());

print('sar2')
print(geometry5.area().divide(1000000));
print(geometry6.length());
print(geometry7.length());
print(geometry8.length());

print('sar2_2')
print(geometry9.area().divide(1000000));
print(geometry10.length());
print(geometry11.length());
print(geometry12.length());

print('sar3')
print(geometry13.area().divide(1000000));
print(geometry14.length());
print(geometry15.length());
print(geometry16.length());

print('sar4')
print(geometry17.area().divide(1000000));
print(geometry18.length());
print(geometry19.length());
print(geometry20.length());

print('sar5')
print(geometry21.area().divide(1000000));
print(geometry22.length());
print(geometry23.length());
print(geometry24.length());

