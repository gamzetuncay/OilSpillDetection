/**** Start of imports. If edited, may not auto-convert in the playground. ****/
var train2 = 
    /* color: #0b4a8b */
    /* shown: false */
    /* displayProperties: [
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      }
    ] */
    ee.Geometry.MultiPolygon(
        [[[[29.500708454377335, 43.28560029198822],
           [29.500708454377335, 43.19055652022356],
           [29.58997237039296, 43.19055652022356],
           [29.58997237039296, 43.28560029198822]]],
         [[[29.802832477814835, 43.369515488030714],
           [29.802832477814835, 43.1464860174495],
           [29.86188399148671, 43.1464860174495],
           [29.86188399148671, 43.369515488030714]]]], null, false),
    train4 = 
    /* color: #ffc82d */
    /* shown: false */
    /* displayProperties: [
      {
        "type": "rectangle"
      }
    ] */
    ee.Geometry.Polygon(
        [[[29.967627399689835, 43.2215870987431],
          [29.967627399689835, 43.16552036256953],
          [30.48810469461171, 43.16552036256953],
          [30.48810469461171, 43.2215870987431]]], null, false),
    train3 = 
    /* color: #00ffff */
    /* shown: false */
    /* displayProperties: [
      {
        "type": "rectangle"
      }
    ] */
    ee.Geometry.Polygon(
        [[[29.42792403054921, 42.59090106271437],
          [29.42792403054921, 42.37619570677376],
          [29.50208174539296, 42.37619570677376],
          [29.50208174539296, 42.59090106271437]]], null, false),
    train5 = 
    /* color: #bf04c2 */
    /* shown: false */
    /* displayProperties: [
      {
        "type": "rectangle"
      }
    ] */
    ee.Geometry.Polygon(
        [[[35.648932331330464, 43.561881396785516],
          [35.648932331330464, 43.46029278330563],
          [35.868658893830464, 43.46029278330563],
          [35.868658893830464, 43.561881396785516]]], null, false),
    train1 = 
    /* color: #ff0000 */
    /* shown: false */
    /* displayProperties: [
      {
        "type": "rectangle"
      }
    ] */
    ee.Geometry.Polygon(
        [[[41.078925007111714, 42.0027714323973],
          [41.078925007111714, 41.76762140739555],
          [41.200461261994526, 41.76762140739555],
          [41.200461261994526, 42.0027714323973]]], null, false),
    geometry = 
    /* color: #00ff00 */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[41.10231313605437, 41.99713195135831],
          [41.08858022589812, 41.96854873248066],
          [41.12222585578093, 41.96599603540148],
          [41.14625844855437, 41.901634305241224],
          [41.142138575507495, 41.882210878258114],
          [41.15518484015593, 41.87812098313957],
          [41.158618067694995, 41.861247398901284],
          [41.155871485663745, 41.84846141542816],
          [41.15724477667937, 41.82237008366226],
          [41.17441091437468, 41.825440204164394],
          [41.17029104132781, 41.85613331223899],
          [41.16342458624968, 41.88425572765488],
          [41.17097768683562, 41.881188429019],
          [41.17715749640593, 41.88425572765488],
          [41.175097559882495, 41.8909010362305],
          [41.186083888007495, 41.89856784101799],
          [41.18402395148406, 41.904700622209475],
          [41.175097559882495, 41.93331247930499],
          [41.158618067694995, 41.98182110841896],
          [41.11879262824187, 41.99713195135831]]]),
    geometry2 = 
    /* color: #0000ff */
    /* shown: false */
    /* displayProperties: [
      {
        "type": "rectangle"
      }
    ] */
    ee.Geometry.Polygon(
        [[[29.526548223854057, 43.2773528154574],
          [29.526548223854057, 43.19481209307026],
          [29.570493536354057, 43.19481209307026],
          [29.570493536354057, 43.2773528154574]]], null, false),
    geometry3 = 
    /* color: #999900 */
    /* shown: false */
    /* displayProperties: [
      {
        "type": "rectangle"
      }
    ] */
    ee.Geometry.Polygon(
        [[[29.438657598854057, 42.61642461966109],
          [29.438657598854057, 42.39166535931849],
          [29.499082403541557, 42.39166535931849],
          [29.499082403541557, 42.61642461966109]]], null, false),
    geometry4 = 
    /* color: #009999 */
    /* shown: false */
    /* displayProperties: [
      {
        "type": "rectangle"
      }
    ] */
    ee.Geometry.Polygon(
        [[[29.97321112668609, 43.2138313807705],
          [29.97321112668609, 43.17628761546003],
          [30.3968714050064, 43.17628761546003],
          [30.3968714050064, 43.2138313807705]]], null, false),
    geometry5 = 
    /* color: #ff00ff */
    /* shown: false */
    /* displayProperties: [
      {
        "type": "rectangle"
      }
    ] */
    ee.Geometry.Polygon(
        [[[35.65578785592926, 43.554259809765036],
          [35.65578785592926, 43.476081694609064],
          [35.887187392062074, 43.476081694609064],
          [35.887187392062074, 43.554259809765036]]], null, false),
    geometry6 = 
    /* color: #ff9999 */
    /* shown: false */
    /* displayProperties: [
      {
        "type": "rectangle"
      }
    ] */
    ee.Geometry.Polygon(
        [[[29.725424214302734, 43.41638277308734],
          [29.725424214302734, 42.90450094620739],
          [29.87408296674414, 42.90450094620739],
          [29.87408296674414, 43.41638277308734]]], null, false),
    geometry7 = 
    /* color: #99ff99 */
    /* shown: false */
    ee.Geometry.LineString(
        [[41.12577645449178, 41.99082336742318],
         [41.16422860292928, 41.834976141052486]]),
    geometry8 = 
    /* color: #9999ff */
    /* shown: false */
    ee.Geometry.LineString(
        [[41.16972176699178, 41.928530141017326],
         [41.1381360736324, 41.9264867091845]]),
    geometry9 = 
    /* color: #ffff99 */
    /* shown: false */
    ee.Geometry.LineString(
        [[29.541572209535158, 43.269488430126046],
         [29.54328882330469, 43.19945202019964]]),
    geometry10 = 
    /* color: #99ffff */
    /* shown: false */
    ee.Geometry.LineString(
        [[29.55324518316797, 43.25248698798615],
         [29.53951227301172, 43.25398730620271]]),
    geometry11 = 
    /* color: #ff99ff */
    /* shown: false */
    ee.Geometry.LineString(
        [[29.84609949225, 43.36366029554001],
         [29.76095544928125, 42.967328183374974]]),
    geometry12 = 
    /* color: #d63000 */
    /* shown: false */
    ee.Geometry.LineString(
        [[29.76095544928125, 42.976873948615705],
         [29.764388676820314, 42.977125132956324]]),
    geometry13 = 
    /* color: #98ff00 */
    /* shown: false */
    ee.Geometry.LineString(
        [[29.491121674958062, 42.597937433756194],
         [29.440701354777197, 42.363534236885435]]),
    geometry14 = /* color: #0b4a8b */ee.Geometry.MultiLineString(
        [[[29.973538268839697, 43.20440557576311],
          [30.150349487101415, 43.20365481080909]],
         [[30.24133001688657, 43.198899751543095],
          [30.335400451456884, 43.19064008359172]],
         [[30.361836303507665, 43.188637571488776],
          [30.396855224406103, 43.186134338969794]]]),
    geometry15 = /* color: #ffc82d */ee.Geometry.LineString(
        [[30.04632269266782, 43.208784853849],
         [30.046666015421728, 43.20340455377124]]),
    geometry16 = 
    /* color: #00ffff */
    /* shown: false */
    ee.Geometry.LineString(
        [[35.661758019030835, 43.54726147462163],
         [35.867751671374585, 43.481531256253334]]),
    geometry17 = /* color: #bf04c2 */ee.Geometry.LineString(
        [[35.7201228871949, 43.51540121886465],
         [35.729392601550366, 43.5275997112844]]),
    geometry18 = /* color: #ff0000 */ee.Geometry.LineString(
        [[29.444615249422974, 42.426124529399836],
         [29.450537566927856, 42.426124529399836]]);
/***** End of imports. If edited, may not auto-convert in the playground. *****/
////    3  Frost
function Frost(img, kernelSize, bandName,  dampingFactor){
    /*
    Input : img = ee.Image type, the image which is processed
          : kernelSize = integer, Square kernel should be odd (typically 3, 5 or 7)
          : band name = string,
          : damping factor = integer, it is an exponential damping is the key factor 
                                      in controlling the smoothness of the filter. 
                                      When damping factor is small, the image tends to be smooth. 
    
    the fuction reduces the noise on the band with the help of Frost Filter function.
    the frost filter works on preserving the edges while suppressing the noise. 
    the function saves the original bands and adds the new low noise band
    
    Output: image with new filtered band 
    
    source: https://groups.google.com/forum/#!msg/google-earth-engine-developers/a9W0Nlrhoq0/Hyu96dv1AgAJ
    */
    
    var band = img.select(bandName);
    
    // ~~(kernelSize/2) does integer division in JavaScript
    var distance_kernel = ee.Kernel.euclidean(~~(kernelSize/2));
  
    var weights = ee.List.repeat(ee.List.repeat(1,kernelSize),kernelSize);
    
    var kernel = ee.Kernel.fixed(kernelSize, kernelSize, weights, ~~(kernelSize/2), ~~(kernelSize/2), false);
    
    // Get mean and variance
    var mean = band.reduceNeighborhood(ee.Reducer.mean(), kernel);
    
    var variance = band.reduceNeighborhood(ee.Reducer.variance(), kernel);
    
    var B = variance.multiply(dampingFactor).divide(mean.multiply(mean));
    
    var W = B.exp().reduceNeighborhood(ee.Reducer.mean(), distance_kernel);
    
    var frost = band.multiply(W).reduceNeighborhood(ee.Reducer.sum(), kernel).divide(W.reduceNeighborhood(ee.Reducer.sum(), kernel));
    
    var newBandName = bandName.concat('_Frost'); 
    
    frost = frost.rename(newBandName);
    
   return img.addBands(frost); // Add filtered band to original image
}

// 1 Study Area
var region010316 = ee.Geometry.Rectangle(
                [41.68959635214067, 41.76163098915713,
                40.995101907596016, 42.27757741759697], null, true);    
    // Dataset
    var sar1 = ee.ImageCollection('COPERNICUS/S1_GRD')
        .filter(ee.Filter.listContains('transmitterReceiverPolarisation','VV'))
        .filter(ee.Filter.listContains('transmitterReceiverPolarisation','VH'))
        .filter(ee.Filter.eq('instrumentMode','IW'))
        .filter(ee.Filter.eq('orbitProperties_pass','DESCENDING'))
        .filterDate('2016-03-08','2016-03-10')
        .filterBounds(region010316);
    print(sar1);
    

// 2 Study Area
var region080819 = ee.Geometry.Rectangle(
                [29.35239035861587,43.39975485811164,
                 30.05949869815924,42.88380842002836], null, true);

    // Dataset
    var sar2 = ee.ImageCollection('COPERNICUS/S1_GRD')
        .filter(ee.Filter.listContains('transmitterReceiverPolarisation','VV'))
        .filter(ee.Filter.listContains('transmitterReceiverPolarisation','VH'))
        .filter(ee.Filter.eq('instrumentMode','IW'))
        .filter(ee.Filter.eq('orbitProperties_pass','DESCENDING'))
        .filterDate('2019-08-08','2019-08-09')
        .filterBounds(region080819);
    print(sar2);
    

// 3 Study Area
var region210719 = ee.Geometry.Rectangle(
                [29.180880485613216, 42.809049704488125,
                29.881258903581966, 42.29310326379858], null, true);

    // Dataset
    var sar3 = ee.ImageCollection('COPERNICUS/S1_GRD')
        .filter(ee.Filter.listContains('transmitterReceiverPolarisation','VV'))
        .filter(ee.Filter.listContains('transmitterReceiverPolarisation','VH'))
        .filter(ee.Filter.eq('instrumentMode','IW'))
        .filter(ee.Filter.eq('orbitProperties_pass','DESCENDING'))
        .filterDate('2019-07-21', '2019-07-26')
        .filterBounds(region210719);
    print(sar3);
    
    
// 4 Study Area
var region220519 = ee.Geometry.Rectangle(
                [30.5878268333208, 42.96969847052448,
                 29.87972286728966, 43.48564490868279], null, true);

    // Dataset
    var sar4 = ee.ImageCollection('COPERNICUS/S1_GRD')
        .filter(ee.Filter.listContains('transmitterReceiverPolarisation','VV'))
        .filter(ee.Filter.listContains('transmitterReceiverPolarisation','VH'))
        .filter(ee.Filter.eq('instrumentMode','IW'))
        .filter(ee.Filter.eq('orbitProperties_pass','DESCENDING'))
        .filterDate('2019-05-22', '2019-05-23')
        .filterBounds(region220519);
    print(sar4);
    
    
// 5 Study Area
var region250915 = ee.Geometry.Rectangle(
                [36.215817911076336, 43.323600262718614,
                 35.503564816425694, 43.83954667563497], null, true);

    // Dataset
    var sar5 = ee.ImageCollection('COPERNICUS/S1_GRD')
        .filter(ee.Filter.listContains('transmitterReceiverPolarisation','VV'))
        .filter(ee.Filter.listContains('transmitterReceiverPolarisation','VH'))
        .filter(ee.Filter.eq('instrumentMode','IW'))
        .filter(ee.Filter.eq('orbitProperties_pass','DESCENDING'))
        .filterDate('2015-09-25', '2015-09-26')
        .filterBounds(region250915);
    print(sar5);
    

sar1 = Frost(sar1.mosaic(), 7, 'VV',-1).select('VV_Frost')
sar2 = Frost(sar2.mosaic(), 7, 'VV',-1).select('VV_Frost')
sar3 = Frost(sar3.mosaic(), 7, 'VV',-1).select('VV_Frost')
sar4 = Frost(sar4.mosaic(), 7, 'VV',-1).select('VV_Frost')
sar5 = Frost(sar5.mosaic(), 7, 'VV',-1).select('VV_Frost')

sar1 = sar1.clip(region010316);
sar2 = sar2.clip(region080819);
sar3 = sar3.clip(region210719);
sar4 = sar4.clip(region220519);
sar5 = sar5.clip(region250915);


// Make the training dataset.
var training1 = sar1.sample({
  region: train1,
  scale: 10,
  numPixels: 5000
});
var training2 = sar2.sample({
  region: train2,
  scale: 10,
  numPixels: 5000
});
var training3 = sar3.sample({
  region: train3,
  scale: 10,
  numPixels: 5000
});
var training4 = sar4.sample({
  region: train4,
  scale: 10,
  numPixels: 5000
});
var training5 = sar5.sample({
  region: train5,
  scale: 10,
  numPixels: 5000
});

 // Instantiate the clusterer and train it.
var clusterer1 = ee.Clusterer.wekaXMeans().train(training1);
var clusterer2 = ee.Clusterer.wekaXMeans().train(training2);
var clusterer3 = ee.Clusterer.wekaXMeans().train(training3);
var clusterer4 = ee.Clusterer.wekaXMeans().train(training4);
var clusterer5 = ee.Clusterer.wekaXMeans().train(training5);
print(clusterer2)
// Cluster the input using the trained clusterer.
var result1 = sar1.cluster(clusterer1,'Oil'); 
var result2 = sar2.cluster(clusterer2,'Oil'); 
var result3 = sar3.cluster(clusterer3,'Oil');
var result4 = sar4.cluster(clusterer4,'Oil'); 
var result5 = sar5.cluster(clusterer5,'Oil');


var Cluster_Histogram1 = ui.Chart.image.histogram(result1.select('Oil'), geometry, 10)
    .setOptions({
       title: 'Histogram of VV Band',
       hAxis: {title: 'Classes'},
       colors: ['#55a839'],
       vAxis: {title: 'Frequency'}});
print(Cluster_Histogram1)
var Cluster_Histogram2 = ui.Chart.image.histogram(result2.select('Oil'), geometry2, 10)
    .setOptions({
       title: 'Histogram of VV Band',
       hAxis: {title: 'Classes'},
       colors: ['#55a839'],
       vAxis: {title: 'Frequency'}});
print(Cluster_Histogram2)
var Cluster_Histogram2_2 = ui.Chart.image.histogram(result2.select('Oil'), geometry6, 10)
    .setOptions({
       title: 'Histogram of VV Band',
       hAxis: {title: 'Classes'},
       colors: ['#55a839'],
       vAxis: {title: 'Frequency'}});
print(Cluster_Histogram2_2)
var Cluster_Histogram3 = ui.Chart.image.histogram(result3.select('Oil'), geometry3, 10)
    .setOptions({
       title: 'Histogram of VV Band',
       hAxis: {title: 'Classes'},
       colors: ['#55a839'],
       vAxis: {title: 'Frequency'}});
print(Cluster_Histogram3)
var Cluster_Histogram4 = ui.Chart.image.histogram(result4.select('Oil'), geometry4, 10)
    .setOptions({
       title: 'Histogram of VV Band',
       hAxis: {title: 'Classes'},
       colors: ['#55a839'],
       vAxis: {title: 'Frequency'}});
print(Cluster_Histogram4)
var Cluster_Histogram5 = ui.Chart.image.histogram(result5.select('Oil'), geometry5, 10)
    .setOptions({
       title: 'Histogram of VV Band',
       hAxis: {title: 'Classes'},
       colors: ['#55a839'],
       vAxis: {title: 'Frequency'}});
print(Cluster_Histogram5)

var imageVisParam2 = {"opacity":1,"bands":["Oil"],"min":0,"max":1,"gamma":1};

////     MAP LAYERS
/*
var imageVisParam = {"opacity":1,"bands":["VV_Frost"],"min":-40,"gamma":1}
Map.addLayer(sar1, imageVisParam, 'sar1')
Map.addLayer(sar2, imageVisParam, 'sar2')
Map.addLayer(sar3, imageVisParam, 'sar3')
Map.addLayer(sar4, imageVisParam, 'sar4')
Map.addLayer(sar5, imageVisParam, 'sar5')
*/

Map.addLayer(result1, imageVisParam2, 'clusters1');
Map.addLayer(result2, imageVisParam2, 'clusters2');
Map.addLayer(result3, imageVisParam2, 'clusters3');
Map.addLayer(result4, imageVisParam2, 'clusters4');
Map.addLayer(result5, imageVisParam2, 'clusters5');



print('sar1')
print(geometry7.length());
print(geometry8.length());

print('sar2')
print(geometry9.length());
print(geometry10.length());


print('sar2_2')
print(geometry11.length());
print(geometry12.length());

print('sar3')
print(geometry13.length());
print(geometry18.length());


print('sar4')
print(geometry14.length());
print(geometry15.length());

print('sar5')
print(geometry16.length());
print(geometry17.length());

